{% extends 'base.html' %}

{% block title %} Home {% endblock %}


{% block body %}

<div class="container" style="margin-top: 15px">
    <div class="row">
        <div class="col">
            <div class="cart-card">
                <div class="card-header bg-primary text-white"><i class="fa fa-envelope"></i> Contact us.
                </div>
                <div class="card-body">
                                       <form id="contactForm">
                      <div class="form-group">
                        <label for="name">Name</label>
                        <input
                            type="text"
                            class="form-control"
                            id="name"
                            name="name"
                            placeholder="Enter name"
                            value="{{ current_user.first_name }} {{ current_user.last_name }}"
                            {% if current_user.is_authenticated %} readonly {% endif %}
                            required
                          >
                      </div>
                      <div class="form-group">
                        <label for="email">Email address</label>
                        <input
                            type="email"
                            class="form-control"
                            id="email"
                            name="email"
                            placeholder="Enter email"
                            value="{{ current_user.email }}"
                            {% if current_user.is_authenticated %} readonly {% endif %}
                            required
                          >
                        <small class="form-text text-muted">We'll never share your email with anyone else.</small>
                      </div>
                      <div class="form-group">
                        <label for="message">Message</label>
                        <textarea class="form-control" id="message" rows="6" required></textarea>
                      </div>
                      <div class="text-center mt-3">
                        <button type="submit" class="btn btn-primary">Send</button>
                      </div>
                    </form>
                </div>
            </div>
        </div>
        <div class="col-12 col-sm-4">
            <div class="card bg-light mb-3">
                <div class="card-header bg-primary text-white text-uppercase"><i class="fa fa-home"></i>OUR contacts</div>
                <div class="card-body text-white">
                    <p>HCS522-Master Project</p>
                    <p>Arbetay University</p>
                    <p>United Kingdom</p>
                    <p>Email : 2406841@abertay.ac.uk</p>
                    <p>Tel. +260771298076</p>

                </div>

            </div>
        </div>
    </div>
</div>
<script>
document.getElementById('contactForm').addEventListener('submit', async function(e) {
    e.preventDefault(); // Prevent normal form submission

    // Collect form data
    const data = {
        name: document.getElementById('name').value.trim(),
        email: document.getElementById('email').value.trim(),
        message: document.getElementById('message').value.trim()
    };

    try {
        const response = await fetch('/api/send-email', {  // API endpoint we'll create
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(data)
        });

        if (response.ok) {
            alert('Message sent successfully!');
            // Optionally clear form
            this.reset();
        } else {
            alert('Failed to send message.');
        }
    } catch (error) {
        alert('Error sending message: ' + error.message);
    }
});
</script>
{% endblock %}